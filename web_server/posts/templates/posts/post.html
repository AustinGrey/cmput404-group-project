<!-- reference: https://www.w3schools.com/bootstrap/tryit.asp?filename=trybs_temp_blog&stacked=h -->
{% extends "navigation.html" %}
{% block navigation_content %}
{% load static %}



<div class="container-fluid">
     <div class="row">
        <div class="col-sm-2">

        </div>
         <div class="col-sm-8">
             <br>
             <br>

             <div class="form-inline">
                 <div class="d-flex w-100 justify-content-between">
                     <h2>{{post.title}}</h2>
                     {% if post.author.id == user.id %}
                     <!-- direct to edit page which is as same as create page-->
                     <div class="btn-group">
                        <button type="button" class="btn btn-light dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <span class="sr-only">Toggle Dropdown</span>
                        </button>
                        <div class="dropdown-menu">
                          <a class="dropdown-item" href="{% url 'edit_or_delete_post' post.id %}">Edit</a>
                            <!--
                            Deleting a post doesn't require a page at this time. So instead we use javascript to call
                            the delete endpoint and the we redirect to the stream
                            -->
                          <a class="dropdown-item" onclick="delete_post()">Delete</a>
                        </div>
                     </div>

                     {% endif %}
                 </div>


             </div>

            <div class="form-inline">
                <h3>{{post.description}}</h3>
            </div>

             <div class="form-inline">
                 <i class="far fa-clock mr-2"></i>
                 <p class="mt-3 mr-2">Post by</p>
                 <a class="mr-2" href="{% url 'profile' post.author.id.hex %}">
                      {{post.author}}
                 </a>
                 <small>{{post.published}}</small>

             </div>


             <div>
                 {% for category in post.categories.all %}
                     <span class="badge badge-success">{{category}}</span>
                 {% endfor %}
                 <span class="badge badge-info">{{post.visibility}}</span>
             </div>

             <br>

             <p>{{post.content}}</p>
             <div>

             </div>

             <hr>

            <h4>Leave a Comment:</h4>

             <form role="form" method="POST" action="{% url 'get_or_add_comment' post.id %}">
                <div class="form-group">
                    <textarea class="form-control" rows="3" required></textarea>
                </div>
             <button type="submit" class="btn btn-light">Submit</button>
            </form>
            <br><br>
             <p>Comments:</p><br>

             <div class="row">

                 <div class="col-sm-10">
                    <h4>Phoebe <small>time</small></h4>
                     <p>hardcode comment</p>
                    <br>
                </div>

             </div>
         </div>

         <div class="col-sm-2"></div>
    </div>
</div>

<script>
    function delete_post() {
        fetch("{% url 'edit_or_delete_post' post.id%}", {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                post_id: "{{ post.id }}"
            })
        })
        .then(response=>{
            if (response.status == 200){
                window.location.href = "{% url "stream" %}"
            } else {
                alert("Unable to delete post")
            }
        })
    }
</script>
{% endblock %}